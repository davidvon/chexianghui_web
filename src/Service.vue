<template>
<body class="" style="" data-width="360" data-height="554">
<div id="screen_wrap" style="min-height: 554px;">
    
    <header id="header">
        <div id="head_nav" class="head_nav">
            <a href="javascript:;" class="fl uinfo_show"><b class="icon"></b></a>
            <div class="nav_title_show"><div class="book_title">洗车美容<b class="slide_down"></b></div></div>
            <div class="user_nav_show clearfix" style="display: none;">
                <div class="nav_list">
                    <a href="/mobile/service" class="nav_icon_btn wash"><b></b><br>洗车美容</a>
                    <a href="/mobile/maintain" class="nav_icon_btn maintain"><b></b><br>维修保养</a>
                    <a href="/mobile/groupon" class="nav_icon_btn tuan"><b></b><br>新车团购</a>
                    <a href="/mobile/carused" class="nav_icon_btn old"><b></b><br>惠心二手车</a>
                    <a href="http://wx.wsq.qq.com/261540592" class="nav_icon_btn community"><b></b><br>爱车社区</a>
                    <a href="/mobile/personal" class="nav_icon_btn personal"><b></b><br>个人中心</a>
                    
                </div>
            </div>
        </div>
    </header>

    <div id="cate_tab" class="cate_tab">
        <div class="nav_cate_wrap" style="display: none;">
            <div class="cate_list_show" id="cate_list">
                <ul class="cate_list clearfix" style="display:block;">
                    
                    <li class="sec_cate" name="精致洗车"> <a href="/mobile/service/1"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">精致洗车</span></a></li>
                    
                    <li class="sec_cate" name="豪华洗车"> <a href="/mobile/service/2"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">豪华洗车</span></a></li>
                    
                    <li class="sec_cate" name="车身打蜡"> <a href="/mobile/service/3"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">车身打蜡</span></a></li>
                    
                    <li class="sec_cate" name="无机镀晶"> <a href="/mobile/service/4"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">无机镀晶</span></a></li>
                    
                    <li class="sec_cate" name="封釉"> <a href="/mobile/service/5"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">封釉</span></a></li>
                    
                    <li class="sec_cate" name="内饰洗护"> <a href="/mobile/service/9"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">内饰洗护</span></a></li>
                    
                    <li class="sec_cate" name="消毒去味"> <a href="/mobile/service/10"><span><img src="http://chexianghui-srv.qiniudn.com/service_item.jpg" alt="">消毒去味</span></a></li>
                    
                </ul>
            </div>
        </div>
    </div>
    <div class="product-list" id="wall_wrap" style="background:#fff">
      <div class="wall_content">
       <!--筛选-->
        <div id="book_wall">
          <div id="filter" class="filter">
            <ul class="cate_select flex_col_box clearfix">
              <!--区域-->
              <li class="all_cate flex_col all_slide_wrap">
                <a href="javascript:;" class="title">区域</a>
                <b class="arrow"></b>
                <ul class="all_cate_list slide_mod" id="city_zone">
                  <li data-id="6"><a href="javascript:;">雨花区</a></li><li data-id="8"><a href="javascript:;">江宁区</a></li>
                </ul>
              </li>
              <!--价格-->
              <li class="all_cate flex_col all_slide_wrap"><a href="javascript:;" class="title">价格</a><b class="arrow"></b>
                <ul class="all_cate_list slide_mod" id="service">
                  <li data-id="0"><a href="javascript:;" filter="all">全部</a></li>
                  <li data-id="1"><a href="javascript:;" filter="from_lower">低-高</a></li>
                  <li data-id="2"><a href="javascript:;" filter="from_high">高-低</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="no_content none"><p>暂无内容</p></div>
      <ul id="martList"><li class="product" attr-pageno="1"><a href="/mobile/service/17/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/jingzhixiche.jpg">                              <h3 class="fn">精致洗车-11月享附赠一辆同行车免单<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥30</strong></p>                              <p class="other">                              <del class="o1">¥50</del>                              <span class="o2">6.0折</span>                              <span class="o3">已售7件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/15/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/jingzhixiche.jpg">                              <h3 class="fn">车享惠独家 超值优惠-精致洗车10次洗车卡<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥258</strong></p>                              <p class="other">                              <del class="o1">¥500</del>                              <span class="o2">5.2折</span>                              <span class="o3">已售2件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/6/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/jingzhixiche.jpg">                              <h3 class="fn">精致洗车<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥30</strong></p>                              <p class="other">                              <del class="o1">¥50</del>                              <span class="o2">6.0折</span>                              <span class="o3">已售128件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/7/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/haohuaxiche.jpg">                              <h3 class="fn">豪华洗车<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥80</strong></p>                              <p class="other">                              <del class="o1">¥100</del>                              <span class="o2">8.0折</span>                              <span class="o3">已售4件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/8/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/cheshendala.jpg">                              <h3 class="fn">车身打蜡（普通清洗+漆面打蜡）<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥180</strong></p>                              <p class="other">                              <del class="o1">¥200</del>                              <span class="o2">9.0折</span>                              <span class="o3">已售2件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/11/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/wujidujing.jpg">                              <h3 class="fn">晶钻硬化（豪华洗车+全车抛光+无机镀晶）<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥2680</strong></p>                              <p class="other">                              <del class="o1">¥3680</del>                              <span class="o2">7.3折</span>                              <span class="o3">已售0件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/10/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/neishiqingxi.jpg">                              <h3 class="fn">车享惠特惠价-内饰清洗（内饰上光）<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥398</strong></p>                              <p class="other">                              <del class="o1">¥580</del>                              <span class="o2">6.9折</span>                              <span class="o3">已售1件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li><li class="product" attr-pageno="1"><a href="/mobile/service/12/detail" class="url">                              <img class="photo" src="http://chexianghui-m.qiniudn.com/xiaoduquwei.jpg">                              <h3 class="fn">臭氧净化<p class="firm">天天汽车会所</p></h3>                              <p class="price"><strong>¥200</strong></p>                              <p class="other">                              <del class="o1">¥240</del>                              <span class="o2">8.3折</span>                              <span class="o3">已售0件</span>                              </p>                              <i class="icon_hongbao"></i>                              </a>                              </li></ul>
   </div>

</div>
<div id="loading_wrap" class="none"><div class="mask"><span></span></div></div>
<div id="mask_wrap" class="none"></div>
<div id="tips_wrap" class="fadeOut none"></div>
<script type="text/javascript" src="/mobile/static/js/zepto.min.js"></script>
<script type="text/javascript" src="/mobile/static/js/app_main.js?v8"></script>


</body>
</template>

<script>
import DevTip from './components/Dev-tip'
import Number from './components/Number'
import Selector from './components/Select'
import Group from './components/Group'
import Btn from './components/Button'
import Tip from './components/Tip'
import Switch from './components/Switch'
import GroupTitle from './components/Group-title'
import Radio from './components/Radio'
import Checklist from './components/Checklist'
import Textarea from './components/Textarea'
import Cell from './components/Cell'
import Xinput from './components/Input'

export default {
  ready: function () {
  },
  components: {
    Number,
    Selector,
    Group,
    Btn,
    Tip,
    Switch,
    GroupTitle,
    Radio,
    DevTip,
    Checklist,
    Textarea,
    Cell,
    Xinput
  },
  data: function () {
    return {
    }
  },
  methods: {
    change: function (value) {
      console.log('change:', value)
    }
  }
}

var current_category_id = '1';
var current_sub_category_id = '';
var default_cities=[{'id':'0','name':'南京'}];
var default_zones = [];
var sel_zone = $('#city_zone');
var sel_service = $('#martList');
$('#loading_wrap').removeClass('none');

$('#city_zone').on('change',function (e) {
     change_select(2, this.value);
})

$('.book_title b').show();

$(".slide_mod a").off().on("touchend", function() {
    var t = $(this), i = t.parent("li"), s = i.parents(".all_slide_wrap");
    setTimeout(function() {
        s.removeClass("active");
        s.find(".title").text(i.text());
        i.addClass("active").siblings().removeClass("active");
        var zone_id = $('#city_zone .active').attr("data-id");
        var service_id = $('#service .active').attr("data-id");
        filter_services(zone_id, service_id);
    }, 100)
})

function filter_services( zone_id, price_id){
    $('#loading_wrap').removeClass('none');

    sel_service.hide();
    sel_service.html('');
    var url = '/api/services?category_id='+ current_category_id +'&sub_category_id='+current_sub_category_id;
    if(zone_id && zone_id.length>0 && zone_id != '0') url = url +'&zone_id='+zone_id;
    if(price_id && price_id.length>0 && price_id != '0') url = url +'&price_id='+price_id;
    $.getJSON(url, function(data){
        var services = data.services;
        for(var i=0; i<services.length; i++){
            var discount = services[i].now_price*10/services[i].price;
            var dom = '<li class="product" attr-pageno="1"><a href="/mobile/service/'+ services[i].id +'/detail" class="url">\
                      <img class="photo" src="'+ services[i].thumb_img +'">\
                      <h3 class="fn">'+ services[i].title+'<p class="firm">'+services[i].firm+'</p></h3>\
                      <p class="price"><strong>¥'+ services[i].now_price +'</strong></p>\
                      <p class="other">\
                      <del class="o1">¥'+ services[i].price +'</del>\
                      <span class="o2">'+ discount.toFixed(1) + '折</span>\
                      <span class="o3">已售'+ services[i].sellcount +'件</span>\
                      </p>\
                      <i class="icon_hongbao"></i>\
                      </a>\
                      </li>';
            sel_service.append(dom);
        }
        setTimeout(function() {
            $('#loading_wrap').addClass('none');
            if(services.length>0){
                $('.no_content').addClass('none');
                sel_service.show();
            } else{
                $('.no_content').removeClass('none');
            }
        }, 50)
    });
}


$(document).ready(function (){
    filter_services();
})

</script>
